<html>

<head>
    <title>Assignment 2 </title>
    <style>
    body { 
    background-color: #92DCE5;
    font-family: 'Arial', sans-serif; 
    margin: 0;
    padding: 0;
    width: 100%;
    }
    #main-nav{ background-color: black;
            color:white;
            text-align: center;          
    }
    #main-nav li:hover 
  { background-color: coral;
   color:white;
  }
  #main-nav ul li {
   list-style: none;
   display: inline-block;
   text-align: center;
   padding: 10px;
  }  
  .container {
    text-align: center;
  }
  .container .button {
  margin: 20px;
}

.custom-button {
  padding: 12px 24px;
  font-weight: bold;
  font-size: 16px;
  border-radius: 12px;
  border: none;
  background-color: white;
  cursor: pointer;
  transition: background-color 0.3s ease;
}
.custom-button:hover {
  background-color: #f0f0f0;
}

.bullish-icon::before { content: 'üêÇ'; }
.bearish-icon::before { content: 'üêª'; }

table {
    border-collapse: collapse;
    margin-left: 20px;
    width: auto;
  }
  th, td {
    border: 2px solid #444;
    padding: 10px;
    text-align: center;
    vertical-align: middle;
    width: 150px;
    height: 120px;
  }
  th {
    font-weight: bold;
    background-color: #fdfdfd;
  }
  td{
    background-color: white;
  }
  a {
    color: #000066;
    text-decoration: underline;
    font-weight: bold;
  }
  a:visited {
    color: #000066;
  }
#audio-instructions {
  background-color: #177145;
  color: white;
  text-align: left;
  padding: 20px;
  margin: 30px auto;
  width: 45%;
  border-radius: 10px;
  font-family: Arial, sans-serif;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}
#audio-instructions h2 {
  font-size: 22px;
  font-weight: bold;
}
#audio-instructions p {
  font-size: 14px;
  margin-bottom: 10px;
}
#audio-instructions ul {
  list-style-type: disc;
  padding-left: 20px;
  font-size: 15px;
}
#audio-instructions ul ul {
  list-style-type: circle;
  padding-left: 30px;
  font-size: 14px;
}
.button-group {
  margin-top: 20px;
  display: flex;
  gap: 20px;
}
    </style>
</head>

<body>
  <h1>INST-377-Activities</h1>
  <nav id="main-nav">
      <ul>
        <li><a class="nav-link" href="home.html">Home</a></li>
        <li><a class="nav-link" href="stocks.html">Stocks</a></li>
        <li><a class="nav-link" href="dogs.html">Dogs</a></li>
      </ul>
  </nav>

  <h1>Let's chart some stocks!</h1>
  <form onsubmit="event.preventDefault(); lookupStock();">
    <input type="text" id="stocks" name="stocks" required>
    <br>
    <select id="days" name="days" required>
      <option value="30">30 Days</option>
      <option value="60">60 Days</option>
      <option value="90">90 Days</option>
    </select>
    <br><br>
    <button type="submit" class="custom-button">Lookup</button>
  </form>

  <canvas id="stockChart" width="600" height="300"></canvas>

  <table id="stockTable">
    <thead>
      <tr>
        <th>TICKER</th>
        <th>COMMENT COUNT</th>
        <th>SENTIMENT</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="audio-instructions">
    <h2>In this web page there are options to Navigate using Audio!</h2>
    <p>Ensure your Mic is enabled to be able to use this feature</p>
    <ul>
      <li><strong>Navigate to a Different Page</strong>
        <ul><li>Say: Navigate to &lt;page&gt;</li></ul>
      </li>
      <li><strong>Change the Page Color</strong>
        <ul><li>Say: Change the color to &lt;color&gt;</li></ul>
      </li>
      <li><strong>Say Hello Back to you!</strong>
        <ul><li>Say: Hello</li></ul>
      </li>
      <li><strong>Lookup a Stock</strong>
        <ul><li>Say: Lookup &lt;ticker&gt; (e.g., Lookup MSFT)</li></ul>
      </li>
    </ul>
    <div class="button-group">
      <button onclick="turnOnAudio()">Turn On Listening</button>
      <button onclick="turnOffAudio()">Turn Off Listening</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/annyang/2.6.1/annyang.min.js"></script>
  <script>
    const apiKey = '7z33C4SsVgjpcrtA4u05XT_jFW2jCIfy';

    async function lookupStock() {
      const ticker = document.getElementById("stocks").value.toUpperCase();
      const days = parseInt(document.getElementById("days").value);

      const toDate = new Date().toISOString().split("T")[0];
      const fromDate = new Date(Date.now() - days * 24 * 60 * 60 * 1000).toISOString().split("T")[0];
      const url = `https://api.polygon.io/v2/aggs/ticker/${ticker}/range/1/day/${fromDate}/${toDate}?adjusted=true&sort=asc&apiKey=${apiKey}`;

      try {
        const response = await fetch(url);
        const data = await response.json();

        if (!data.results || data.results.length === 0) {
          alert("No data returned. Check the ticker symbol or try again later.");
          return;
        }

        const labels = data.results.map(entry => new Date(entry.t).toLocaleDateString());
        const values = data.results.map(entry => entry.c);

        new Chart(document.getElementById("stockChart"), {
          type: 'line',
          data: {
            labels,
            datasets: [{
              label: `${ticker} Closing Prices`,
              data: values,
              fill: false,
              borderColor: 'black',
              tension: 0.1
            }]
          }
        });
      } catch (error) {
        console.error(error);
        alert("An error occurred while fetching stock data.");
      }
    }

    async function loadTopStocks() {
      const response = await fetch("https://tradestie.com/api/v1/apps/reddit?date=2022-04-03");
      const data = await response.json();
      const top5 = data.slice(0, 5);

      const tbody = document.querySelector("#stockTable tbody");
      tbody.innerHTML = "";

      top5.forEach(stock => {
        const row = document.createElement("tr");
        const sentimentClass = stock.sentiment === "Bullish" ? "bullish-icon" : "bearish-icon";
        row.innerHTML = `
          <td><a href="https://finance.yahoo.com/quote/${stock.ticker}" target="_blank">${stock.ticker}</a></td>
          <td>${stock.no_of_comments}</td>
          <td class="${sentimentClass}">${stock.sentiment}</td>
        `;
        tbody.appendChild(row);
      });
    }

    if (annyang) {
      const commands = {
        'hello': () => alert('Hello World'),
        'change the color to *color': color => document.body.style.backgroundColor = color.toLowerCase(),
        'navigate to *page': page => {
          const lower = page.toLowerCase();
          if (lower.includes('home')) location.href = 'home.html';
          else if (lower.includes('stock')) location.href = 'stocks.html';
          else if (lower.includes('dog')) location.href = 'dogs.html';
        },
        'lookup *ticker': ticker => {
          document.getElementById('stocks').value = ticker.toUpperCase();
          document.getElementById('days').value = '30';
          lookupStock();
        }
      };
      annyang.addCommands(commands);
      annyang.start();

      function turnOffAudio() { annyang.abort(); }
      function turnOnAudio() { annyang.start(); }

      window.turnOffAudio = turnOffAudio;
      window.turnOnAudio = turnOnAudio;
    }

    window.onload = loadTopStocks;
  </script>

</body>
</html>
